{% extends "base.html" %}

{% block title %}{% if is_edit %}Edit Variant{% else %}Create Variant{% endif %} - X Scheduler{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <h1 class="text-3xl font-bold text-gray-900 mb-8">{% if is_edit %}Edit Variant{% else %}Create New Variant{% endif %}</h1>
    
    <div class="bg-white rounded-lg shadow-lg p-8">
        <form id="variant-form" hx-post="{% if is_edit %}/api/variants/{{ variant.id }}{% else %}/api/templates/{{ template_id }}/variants{% endif %}" hx-target="#result" hx-swap="innerHTML">
            <div class="mb-6">
                <label for="text" class="block text-sm font-medium text-gray-700 mb-2">
                    Variant Text *
                </label>
                <textarea 
                    id="text" 
                    name="text" 
                    rows="6" 
                    required
                    maxlength="280"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"
                    placeholder="Enter the post text variant...">{% if variant %}{{ variant.text }}{% endif %}</textarea>
                <div class="mt-2 flex justify-between items-center">
                    <span class="text-sm text-gray-500">Character count</span>
                    <span id="char-count" class="text-sm font-medium text-gray-700">0/280</span>
                </div>
            </div>
            
            <div class="mb-6">
                <label for="weight" class="block text-sm font-medium text-gray-700 mb-2">
                    Weight (for weighted selection)
                </label>
                <input 
                    type="number" 
                    id="weight" 
                    name="weight" 
                    min="1"
                    value="{% if variant %}{{ variant.weight }}{% else %}1{% endif %}"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <p class="mt-2 text-sm text-gray-500">Higher weight = more likely to be selected (for RANDOM_WEIGHTED policy)</p>
            </div>
            
            <div class="mb-6">
                <label for="media_refs" class="block text-sm font-medium text-gray-700 mb-2">
                    Media References (Optional)
                </label>
                <input 
                    type="text" 
                    id="media_refs" 
                    name="media_refs"
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                    placeholder='["url1", "url2"] - JSON array of media URLs'
                    value="{% if variant and variant.media_refs %}{{ variant.media_refs }}{% endif %}">
                <p class="mt-2 text-sm text-gray-500">Enter as JSON array of media URLs or IDs</p>
            </div>
            
            {% if is_edit %}
            <div class="mb-6">
                <label class="flex items-center gap-2 cursor-pointer">
                    <input 
                        type="checkbox" 
                        id="active" 
                        name="active"
                        class="w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500"
                        {% if variant and variant.active %}checked{% endif %}>
                    <span class="text-sm font-medium text-gray-700">Active</span>
                </label>
                <p class="mt-1 text-sm text-gray-500">Inactive variants won't be selected</p>
            </div>
            {% endif %}
            
            <div id="result"></div>
            
            <div class="flex gap-4">
                <button 
                    type="submit" 
                    class="bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition-colors font-semibold">
                    {% if is_edit %}Update Variant{% else %}Create Variant{% endif %}
                </button>
                <a 
                    href="/template/{{ template_id }}{% if is_edit %}{% endif %}" 
                    class="bg-gray-200 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-300 transition-colors font-semibold">
                    Cancel
                </a>
            </div>
        </form>
    </div>
</div>

<script>
    // Character count
    document.addEventListener('DOMContentLoaded', function() {
        const textarea = document.getElementById('text');
        const charCount = document.getElementById('char-count');
        
        function updateCharCount() {
            const count = textarea.value.length;
            charCount.textContent = `${count}/280`;
            if (count > 280) {
                charCount.classList.add('text-red-600');
            } else {
                charCount.classList.remove('text-red-600');
            }
        }
        
        textarea.addEventListener('input', updateCharCount);
        updateCharCount();
    });
</script>
{% endblock %}

